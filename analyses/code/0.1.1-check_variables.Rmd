---
title: "Variable Check"
output:
  github_document:
  # html_document:
  #   code_folding: hide
  #   toc: yes
  #   toc_float: yes
  # pdf_document:
  #   toc: yes
---

```{r setup}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, cache = FALSE, out.width = "50%")
```

```{r initialize}
if (!require(pacman)) install.packages("pacman")
pacman::p_load(data.table, corrplot, ltm)
pacman::p_load_gh("janajarecki/themejj")
.default_font <- "Roboto Condensed"
theme_set(theme_classic())

# set working directory to THIS file location
# setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Load preprocessed data
source("0.1-preprocess.R")
d <- fread("../../data/processed/data.csv")

corrplot.mixed <- function(data) {
  colnames(data) <- gsub("_", "\n", colnames(data))
  a <- cronbach.alpha(data)$alpha 
  corrplot::corrplot.mixed(cor(data), order="hclust", tl.col="black", title= paste("Cronbach's alpha = ", round(a, 2)), mar=c(0,0,1,0))
}

hist.raw <- function(var, true = NA, bw) {
  pp <- ggplot(d, aes_string(x = var)) +
  geom_histogram(binwidth = bw, color = "black", fill = "grey90") +
  scale_y_continuous(expand = c(0,0))
  if (!is.na(true)) pp <- pp + geom_vline(aes(xintercept = true), color = "red", size = 2)
  plot(pp)
}
```

# Sample
A total of `r nrow(d) + length(unique(unlist(excluded$V1)))` participants participated, `r length(unique(unlist(excluded$V1)))` were excluded, `r excluded[, sum(!is.na(progress))]` because they did not finish the survey; leaving **_N =_ `r nrow(d)`**.



# Independent Variables
## Risk Attitudes
 How much risk do you take regarding ... ?
```{r risk, fig.dim = c(4,4)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^risk")])
```

## Risk Knowledge and other Knowledge
 Knowledge, Total Deaths, Total Infected
```{r know, , fig.width = c(7,7)}
corrplot.mixed(data = d[, lapply(.SD, as.double), .SDcols = patterns("^know")][, -c("know_symptoms", "know_symptoms_perc")])
hist.raw("raw_know_death_total", 2000, 300)
hist.raw("raw_know_infected_all_ab", 35000, 2000)
hist.raw("know_econ", NA, 25)
hist.raw("raw_know_age", 75, 5)
hist.raw("know_symptoms_perc", NA, .05)
hist.raw("perc_infected_next7", NA, 5)
hist.raw("perc_infected_last7", NA, 5)
hist.raw("perc_data", NA, 5)

```

## Identification with all Humanity
```{r iwah, fig.width = c(3,3)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^iwah_community$|iwah_swiss$|iwah_world$")])
```

## Safety-related behavior
```{r safety, fig.width = c(3,3)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^safety")])
hist.raw("safety_mask", bw = .1)
hist.raw("safety_distance", bw = .1)
hist.raw("safety_hygene", bw = .1)

```

## belief local/global
```{r belief, , fig.width = c(3,3)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^belief_l|^belief_g")])
```

## belief local/global and identification with all humanity
```{r belief-iwah, fig.width = c(4,4)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^belief_l|^belief_g|iwah_s|iwah_w")])
```

# Honesty Humility
```{r honhum}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^honhum")])
```

# Honesty Humility
```{r honhum-risk}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^honhum_score|^risk")])
```


# Tech
```{r tech}
corrplot.mixed(data = d[has_smartphone == 1, .SD, .SDcols = patterns("^tech")][, -"tech_score"])
```

## Tech - Compliance
 Tech Interest only if has_smartphone == true
```{r tech-compliance}
corrplot.mixed(data = d[has_smartphone == 1, .SD, .SDcols = patterns("^tech")][, -"tech"])
```

# Policy
```{r policy}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^attitudes")])
```

# Comprehension of the App's working
```{r understanding}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^comprehe")])
```

# Safety-related behavior
```{r hygene}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("safety|^risk_domain_health")])
```


# Non-response checks
```{r nas}
  knitr::kable(
    d[, .(income = table(income_num_1_text == ""),
        wealth = table(wealth_num_1_text == ""))]
  )
```



# Dependent Variables
## Acceptance
```{r acc, fig.dim = c(4,4)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^acc_")])
```

## Compliance
```{r com, fig.dim = c(4,4)}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^com_")])
```


## Raw correlations between IVs and DVs
 Tech - Acceptance
```{r tech-acceptance}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^tech$|accept_index")])
```

  Compliance - Acceptance
```{r com-acceptance}
corrplot.mixed(data = d[, .SD, .SDcols = patterns("^comply_index|accept_index")])
```